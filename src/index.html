<html><head>
    <title>Fall detection</title>
    <style>
        /* Add some CSS for styling the scrollable area */
        #messages {
            overflow-y: scroll;
            height: 45vh;
            /* Limit the height of the scrollable area */
            width: 80vw;
            /* Limit the height of the scrollable area */
        }
        #warning {
            height: 45vh;     
            width: 60vw;
        }
    </style>
</head>

<body>
    <h1>Fall Detection Device Portal</h1>
    <ul id="warning" style="list-style-type: none; display: inline-block;">
    <button id="closeButton">Call Patient</button>
    </ul>
    <ul id="messages" style="list-style-type: none; display: inline-block;">
    </ul>
    <script>
        // Change Ip address based on your current wifi ip address
        var ws = new WebSocket("ws://192.168.25.139:8000/ws");
        ws.onopen = function (event) {
            console.log("WebSocket state:", ws.readyState);  // This will log "OPEN"
        };
        ws.onmessage = function (event) {
            console.log("Received data:", event.data);

            if (event.data.includes("name")) {
                var patinf = JSON.parse(event.data);

                var warning = document.getElementById('warning');
                var patientInfoHtml = `<div class="patient-info">
                    <h1>!!!PATIENT FALL DETECTED!!!<h2>
                    <h2>Patient Name: ${patinf.name}</h2>
                    <ul>
                        <li>Address: ${patinf.adress}</li>
                        <li>Phone Number: ${patinf.phonenumber}</li>
                        <li>Medical Conditions: ${patinf.conditions.join(', ')}</li>
                        <li>Active Medications: ${patinf.medications.join(', ')}</li>
                    </ul>
                </div>`;

                warning.innerHTML += patientInfoHtml;
            } else {
                var messages = document.getElementById('messages');
                var message = document.createElement('li');
                var content = document.createTextNode(event.data);
                message.appendChild(content);

               


            // Append the new li element to the ul element
            messages.appendChild(message);
            var listLength = document.querySelectorAll('#messages li').length;
            if (listLength > 50) {
                messages.removeChild(messages.firstElementChild);
            }

            // Scroll to the bottom
            messages.scrollTop = messages.scrollHeight;
            }

        };

        close = function () {
            ws.close();
            console.log("Connection Closed");
        };

        open = function () {
            ws = new WebSocket("ws://192.168.25.139:8000/ws");;
            console.log("WebSocket state:", ws.readyState);
        }

        // Add onclose event handler
        ws.onclose = function (event) {
            console.log("WebSocket closed:", event);
        };

        var closeButton = document.getElementById('closeButton');
        closeButton.addEventListener('click', function () {
            // Call the close function when the button is clicked
            close();
        });

        var openButton = document.getElementById('openButton')
        openButton.addEventListener('click', function () {
            //Hopefully will call the open function which starts the onopen function?
            open();
        })
    </script>


</body></html>
